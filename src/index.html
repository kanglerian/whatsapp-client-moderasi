<!doctype html>
<html>
    <head>
        <meta charset="UTF-8" />
        <title>Whatsapp Blast Sender For Moderasi</title>
        <link rel="stylesheet" href="./css/all.min.css" />
        <link rel="stylesheet" href="./css/output.css" />
    </head>

    <body class="grid grid-cols-1 md:grid-cols-2 h-screen">
        <section
            class="flex bg-slate-50 h-full border-r-2 border-gray-300 overflow-y-auto md:overflow-hidden"
        >
            <div
                class="w-full flex flex-col justify-between p-8 bg-white h-full"
            >
                <nav
                    class="flex flex-col md:flex-row items-center justify-between"
                >
                    <a
                        href="#"
                        onclick="location.reload()"
                        class="flex items-center gap-2"
                    >
                        <img
                            src="./images/whatsapp.webp"
                            alt="Whatsapp"
                            class="w-10"
                        />
                        <span class="font-bold text-lg"
                            >Whatsapp Blast Sender</span
                        >
                    </a>
                </nav>
                <!-- Message -->
                <main id="message-container" class="hidden">
                    <form
                        id="form"
                        method="POST"
                        enctype="multipart/form-data"
                        class="space-y-3"
                    >
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                            <div>
                                <label
                                    for="contact"
                                    class="block mb-2 text-xs font-medium text-gray-900"
                                    >Kontak</label
                                >
                                <input
                                    type="file"
                                    name="contactFile"
                                    id="contact"
                                    accept=".csv, .txt"
                                    class="bg-gray-50 border border-gray-300 text-gray-900 text-xs rounded-xl focus:ring-blue-500 focus:border-blue-500 block w-full px-4 py-3"
                                    required
                                />
                                <div
                                    class="bg-gray-50 border border-gray-300 text-gray-900 px-3 py-1 text-xs rounded-lg mt-1 space-y-1"
                                >
                                    <div>
                                        <span class="text-slate-800 font-bold"
                                            >Contoh:</span
                                        >
                                        <code class="text-slate-800"
                                            >nama
                                            1,081233123777,abc123,...</code
                                        >
                                    </div>
                                </div>
                                <p
                                    id="contact-helper"
                                    class="mt-1 ml-1 text-[11px] text-red-600"
                                >
                                    Masukan file kontak dengan format .txt /
                                    .csv
                                </p>
                            </div>
                            <div>
                                <label
                                    for="media"
                                    class="block mb-2 text-xs font-medium text-gray-900"
                                    >Media</label
                                >
                                <input
                                    type="file"
                                    name="image"
                                    id="image"
                                    class="bg-gray-50 border border-gray-300 text-gray-900 text-xs rounded-xl focus:ring-blue-500 focus:border-blue-500 block w-full px-4 py-3"
                                />
                                <p
                                    id="media-helper"
                                    class="mt-1 ml-1 text-[11px] text-red-600"
                                >
                                    Unggah berkas dengan contoh: .pdf
                                </p>
                            </div>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                            <div>
                                <label
                                    for="titleMessage"
                                    class="block mb-2 text-xs font-medium text-gray-900"
                                    >Judul Pesan</label
                                >
                                <input
                                    type="text"
                                    name="titleMessage"
                                    id="titleMessage"
                                    value="Perkenalan"
                                    class="bg-gray-50 border border-gray-300 text-gray-900 text-xs rounded-xl focus:ring-blue-500 focus:border-blue-500 block w-full px-4 py-3"
                                    placeholder="Judul Pesan"
                                    required
                                />
                                <p
                                    id="title-helper"
                                    class="mt-1 ml-1 text-[11px] text-red-600"
                                >
                                    Penting! Ganti judul sekarang.
                                </p>
                            </div>
                            <div>
                                <label
                                    for="schedule"
                                    class="block mb-2 text-xs font-medium text-gray-900"
                                    >Jadwal</label
                                >
                                <input
                                    type="datetime-local"
                                    name="schedule"
                                    id="schedule"
                                    value="Perkenalan"
                                    class="bg-gray-50 border border-gray-300 text-gray-900 text-xs rounded-xl focus:ring-blue-500 focus:border-blue-500 block w-full px-4 py-3"
                                    required
                                />
                            </div>
                        </div>
                        <div class="grid grid-cols-1 gap-3">
                            <div class="text-xl cursor-pointer" id="emoticon">
                                <span>âœ…</span>
                                <span>ğŸ‡²ğŸ‡¨</span>
                                <span>ğŸ‘‹</span>
                                <span>ğŸ™Œ</span>
                                <span>ğŸ¤²</span>
                                <span>ğŸ¤</span>
                                <span>ğŸ¥³</span>
                                <span>ğŸ˜±</span>
                                <span>ğŸ¤©</span>
                                <span>ğŸ˜Š</span>
                                <span>ğŸ˜‰</span>
                                <span>ğŸ¤—</span>
                                <span>ğŸ‘‡</span>
                                <span>ğŸ‘</span>
                                <span>âœ¨</span>
                                <span>ğŸ“</span>
                                <span>ğŸ˜‚</span>
                                <span>ğŸ’ªğŸ»</span>
                                <span>ğŸ™</span>
                                <span>1ï¸âƒ£</span>
                                <span>2ï¸âƒ£</span>
                                <span>3ï¸âƒ£</span>
                                <span>4ï¸âƒ£</span>
                                <span>5ï¸âƒ£</span>
                            </div>
                            <div class="flex flex-wrap gap-2">
                                <div
                                    id="add-fullname"
                                    class="cursor-pointer py-1 px-3 text-xs text-white rounded-lg bg-red-600 hover:bg-red-700"
                                >
                                    <i class="fa-solid fa-circle-plus mr-1"></i
                                    ><i class="fa-solid fa-address-card"></i>
                                    Nama
                                </div>
                                <div
                                    id="add-firstname"
                                    class="cursor-pointer py-1 px-3 text-xs text-white rounded-lg bg-red-600 hover:bg-red-700"
                                >
                                    <i class="fa-solid fa-circle-plus mr-1"></i
                                    ><i class="fa-solid fa-address-card"></i>
                                    Firstname
                                </div>
                                <div
                                    id="add-whatsapp"
                                    class="cursor-pointer py-1 px-3 text-xs text-white rounded-lg bg-red-600 hover:bg-red-700"
                                >
                                    <i class="fa-solid fa-circle-plus mr-1"></i
                                    ><i class="fa-brands fa-whatsapp"></i>
                                    Whatsapp
                                </div>
                                <div
                                    id="add-var1"
                                    class="cursor-pointer py-1 px-3 text-xs text-white rounded-lg bg-emerald-500 hover:bg-emerald-600"
                                >
                                    <i class="fa-solid fa-tag"></i> 1
                                </div>
                                <div
                                    id="add-var2"
                                    class="cursor-pointer py-1 px-3 text-xs text-white rounded-lg bg-emerald-500 hover:bg-emerald-600"
                                >
                                    <i class="fa-solid fa-tag"></i> 2
                                </div>
                                <div
                                    id="add-var3"
                                    class="cursor-pointer py-1 px-3 text-xs text-white rounded-lg bg-emerald-500 hover:bg-emerald-600"
                                >
                                    <i class="fa-solid fa-tag"></i> 3
                                </div>
                                <div
                                    id="add-var4"
                                    class="cursor-pointer py-1 px-3 text-xs text-white rounded-lg bg-emerald-500 hover:bg-emerald-600"
                                >
                                    <i class="fa-solid fa-tag"></i> 4
                                </div>
                                <div
                                    id="add-var5"
                                    class="cursor-pointer py-1 px-3 text-xs text-white rounded-lg bg-emerald-500 hover:bg-emerald-600"
                                >
                                    <i class="fa-solid fa-tag"></i> 5
                                </div>
                            </div>
                            <div class="flex items-center gap-5">
                                <div class="w-full">
                                    <label
                                        for="message"
                                        class="block mb-2 text-xs font-medium text-gray-900"
                                        >Pesan</label
                                    >
                                    <textarea
                                        id="message"
                                        rows="4"
                                        class="block px-4 py-3 w-full text-xs text-gray-900 bg-gray-50 rounded-xl border border-gray-300 focus:ring-blue-500 focus:border-blue-500"
                                        placeholder="Tulis pesan disini..."
                                        required
                                    ></textarea>
                                </div>
                                <div class="w-1/3 text-xs">
                                    <span class="text-slate-800 font-bold"
                                        >Panduan:</span
                                    ><br />
                                    <span
                                        id="text-italic"
                                        class="cursor-pointer text-slate-800"
                                        >Miring <code><i>_teks_</i></code></span
                                    ><br />
                                    <span
                                        id="text-bold"
                                        class="cursor-pointer text-slate-800"
                                        >Tebal <code><b>*teks*</b></code></span
                                    ><br />
                                    <span
                                        id="text-strike"
                                        class="cursor-pointer text-slate-800"
                                        >Coretan
                                        <code><s>~teks~</s></code></span
                                    ><br />
                                </div>
                            </div>
                            <div class="flex items-center gap-3">
                                <div
                                    class="border border-gray-300 px-3 py-2 text-xs rounded-xl text-slate-700 bg-gray-50"
                                >
                                    Gunakan
                                    <code class="text-blue-500">&var0</code>,
                                    <code class="text-blue-500">&var1</code>,
                                    <code class="text-blue-500">...</code> untuk
                                    custom variabel<br />Contoh: "Halo
                                    <code class="text-blue-500">&var0</code>,
                                    status kamu
                                    <code class="text-blue-500">&var2</code>.
                                    Selamat ya!"
                                </div>
                                <div class="flex items-center gap-2">
                                    <button
                                        type="button"
                                        onclick="saveMessage()"
                                        id="btnSave"
                                        class="flex justify-center items-center text-white text-sm bg-sky-500 hover:bg-sky-600 h-9 w-9 rounded-full"
                                    >
                                        <i class="fa-solid fa-floppy-disk"></i>
                                    </button>
                                    <button
                                        type="button"
                                        onclick="getMessage()"
                                        id="restoreMessage"
                                        class="hidden justify-center items-center text-white text-sm bg-emerald-500 hover:bg-emerald-600 h-9 w-9 rounded-full"
                                    >
                                        <i class="fa-solid fa-rotate-left"></i>
                                    </button>
                                    <button
                                        type="button"
                                        onclick="removeMessage()"
                                        id="removeMessage"
                                        class="hidden justify-center items-center text-white text-sm bg-red-500 hover:bg-red-600 h-9 w-9 rounded-full"
                                    >
                                        <i class="fa-solid fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                            <button
                                type="submit"
                                class="bg-sky-500 hover:bg-sky-600 text-white py-2 px-5 rounded-xl text-xs"
                            >
                                <i class="fa-solid fa-paper-plane mr-1"></i>
                                Kirim
                            </button>
                        </div>
                    </form>
                </main>
                <!-- End Chat -->
                <!-- Authentication -->
                <main id="authentication-container" class="space-y-5">
                    <div class="space-y-2">
                        <h2 class="font-bold text-4xl leading-snug">
                            Whatsapp Blast Sender<br />Untuk Moderasi Beragama
                        </h2>
                        <p class="text-gray-700 text-sm">
                            Best practice Direct Digital Marketing 4.0 untuk
                            peningkatan implementasi moderasi beragama.
                            Mengoptimalkan strategi pemasaran digital modern
                            untuk mendukung kampanye moderasi beragama yang
                            efektif, inklusif, dan menyeluruh.
                        </p>
                    </div>
                    <div
                        class="w-full flex items-center gap-5"
                        id="identity-container"
                    >
                        <input
                            type="number"
                            id="identity"
                            placeholder="Tulis kode ID anda disini..."
                            class="w-full bg-slate-50 border border-slate-300 px-5 py-4 rounded-2xl text-xs"
                        />
                        <button
                            type="button"
                            onclick="setIdentity()"
                            class="flex items-center gap-2 px-5 py-4 bg-[#25D366] hover:bg-[#24C861] text-white rounded-2xl text-xs"
                        >
                            <i class="fa-solid fa-right-to-bracket"></i> Masuk
                        </button>
                    </div>
                    <div id="loading-container" class="hidden">
                        <lottie-player
                            src="./animation/loading.json"
                            background="transparent"
                            speed="1"
                            style="width: 100px; height: 100px"
                            loop
                            autoplay
                        ></lottie-player>
                    </div>
                    <div id="qrcode-container" class="space-y-3">
                        <img
                            src="./img/qrcode-sample.png"
                            alt="QR Code"
                            id="qrcode"
                            class="w-48 border border-gray-200"
                        />
                        <div class="text-xs text-gray-700">
                            Jika terjadi
                            <span class="font-medium text-red-600"
                                >"Tidak dapat menautkan perangkat"</span
                            >
                            maka
                            <span class="text-emerald-600"
                                >tunggu sampai QR Code</span
                            >
                            berubah.
                        </div>
                    </div>
                </main>
                <!-- End Authentication -->
                <footer class="flex items-center justify-between">
                    <a
                        href="https://kanglerian.github.io"
                        target="_blank"
                        class="text-xs text-gray-600 hover:text-gray-900"
                        >Copyright Â© 2024 Whatsapp Moderasi</a
                    >
                </footer>
            </div>
        </section>
        <section
            id="chat-container"
            class="relative flex flex-col bg-[#25D366] h-full overflow-hidden"
        >
            <div
                class="h-1/3 flex flex-col gap-5 justify-center items-center pb-5 overflow-y-auto"
                id="info-container"
            >
                <div class="text-center space-y-3">
                    <i class="fa-brands fa-whatsapp fa-3x text-white"></i>
                    <div id="signal" class="text-white text-sm font-medium">
                        Whatsapp Sender
                    </div>
                </div>
                <div id="url-container" class="w-1/2 flex items-center gap-3">
                    <div class="w-full relative">
                        <input
                            type="password"
                            id="url"
                            class="w-full bg-white text-emerald-900 text-xs rounded-xl block px-4 py-2"
                            value="http://localhost:3000"
                        />
                        <button
                            type="button"
                            onclick="changeType()"
                            class="absolute top-2 right-2 text-[11px] text-gray-400 hover:text-gray-500"
                        >
                            <i class="fa fa-solid fa-eye"></i>
                        </button>
                    </div>
                    <button
                        type="button"
                        onclick="setPath()"
                        class="flex items-center gap-2 bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-xl text-xs"
                    >
                        <i class="fa fa-solid fa-server"></i> Setup
                    </button>
                </div>
                <div
                    id="sent-percent-container"
                    class="w-5/6 flex flex-col justify-center gap-3 bg-white px-5 py-3 rounded-3xl border-4 border-emerald-500"
                >
                    <div
                        id="sent-container"
                        class="w-full flex justify-center"
                    ></div>
                    <div class="w-full hidden" id="percent-container">
                        <div class="w-full bg-slate-200 rounded-full">
                            <div
                                id="percent"
                                class="w-full bg-sky-500 text-xs font-medium text-sky-100 text-center p-0.5 leading-none rounded-full"
                                style="width: 50%"
                            >
                                100%
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <main
                id="history-container"
                class="flex flex-col h-2/3 gap-3 pb-8 px-8"
            >
                <section class="h-full overflow-y-auto">
                    <div
                        class="h-full rounded-3xl bg-white border-4 border-emerald-500 overflow-hidden"
                    >
                        <div class="relative overflow-x-auto h-full">
                            <table
                                class="w-full text-xs text-left rtl:text-right text-gray-500"
                            >
                                <thead
                                    class="text-xs text-gray-700 text-center uppercase bg-gray-50"
                                >
                                    <tr>
                                        <th scope="col" class="px-6 py-3">
                                            No.
                                        </th>
                                        <th scope="col" class="px-6 py-3">
                                            Jadwal
                                        </th>
                                        <th scope="col" class="px-6 py-3">
                                            Media
                                        </th>
                                        <th scope="col" class="px-6 py-3">
                                            Status
                                        </th>
                                        <th scope="col" class="px-6 py-3">
                                            Aksi
                                        </th>
                                    </tr>
                                </thead>
                                <tbody
                                    id="schedules-table"
                                    class="text-xs text-center pb-5"
                                >
                                    <tr class="bg-white border-b">
                                        <td
                                            class="px-6 py-4 text-gray-600"
                                            colspan="5"
                                        >
                                            Memuat data...
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </section>
                <section class="h-full overflow-y-auto">
                    <div
                        class="h-full rounded-3xl bg-white border-4 border-emerald-500 overflow-hidden"
                    >
                        <nav
                            class="flex justify-center items-center gap-2 py-3"
                        >
                            <button
                                onclick="filterHistory('1')"
                                role="button"
                                class="px-3 py-1.5 text-xs rounded-xl bg-emerald-600 hover:bg-emerald-700 text-white"
                            >
                                <i class="fa-solid fa-circle-check"></i>
                            </button>
                            <button
                                onclick="filterHistory('0')"
                                role="button"
                                class="px-3 py-1.5 text-xs rounded-xl bg-red-600 hover:bg-red-700 text-white"
                            >
                                <i class="fa-solid fa-circle-xmark"></i>
                            </button>
                            <button
                                role="button"
                                onclick="stop()"
                                class="px-3 py-1.5 text-xs rounded-xl bg-red-600 hover:bg-red-700 text-white"
                            >
                                <i class="fa-solid fa-stop"></i>
                            </button>
                            <button
                                role="button"
                                onclick="deleteHistory()"
                                class="px-3 py-1.5 text-xs rounded-xl bg-red-600 hover:bg-red-700 text-white"
                            >
                                <i class="fa-solid fa-trash"></i>
                            </button>
                        </nav>
                        <div class="relative overflow-x-auto h-full">
                            <table
                                class="w-full text-xs text-left rtl:text-right text-gray-500"
                            >
                                <thead
                                    class="text-xs text-gray-700 text-center uppercase bg-gray-50"
                                >
                                    <tr>
                                        <th scope="col" class="px-6 py-3">
                                            No.
                                        </th>
                                        <th scope="col" class="px-6 py-3">
                                            Nama
                                        </th>
                                        <th scope="col" class="px-6 py-3">
                                            No. Telpon
                                        </th>
                                        <th scope="col" class="px-6 py-3">
                                            Status
                                        </th>
                                    </tr>
                                </thead>
                                <tbody
                                    id="history"
                                    class="text-xs text-center pb-5"
                                >
                                    <tr class="bg-white border-b">
                                        <td
                                            class="px-6 py-4 text-gray-600"
                                            colspan="4"
                                        >
                                            Memuat data...
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </section>
            </main>
            <button
                type="button"
                onclick="deletePath()"
                class="absolute top-3 right-3 px-3 py-2 rounded-xl bg-red-600 hover:bg-red-700 border-2 border-white text-white text-[12px]"
            >
                <i class="fa-solid fa-power-off"></i>
            </button>
            <p
                id="logging"
                class="absolute bottom-1 left-2 text-[11px] text-emerald-100 z-2"
            ></p>
        </section>
        <script src="./javascript/all.min.js"></script>
        <script src="./javascript/jquery-3.7.0.min.js"></script>
        <script src="./javascript/lottie-player.js"></script>
        <script src="./javascript/axios.min.js"></script>
        <script src="./javascript/socket.io.min.js"></script>
        <script src="./javascript/server/socket.js"></script>
        <script src="./javascript/setting/server.js"></script>
        <script src="./javascript/setting/default.js"></script>
        <script src="./javascript/utilities/emoji.js"></script>
        <script src="./javascript/utilities/message.js"></script>
        <script src="./javascript/utilities/history.js"></script>
        <script>
            const setIdentity = async () => {
                let identity = document.getElementById("identity").value;
                if (identity == 46151) {
                    socket.emit("setIdentity", identity);
                    socketSetup();
                } else {
                    alert("Akun Tidak Ditemukan.");
                }
            };

            $("#form").submit((e) => {
                e.preventDefault();
                var contacts = $("#contact");
                var image = $("#image");
                var message = $("#message").val();
                var schedule = $("#schedule").val();
                var titleMessage = $("#titleMessage").val();
                var identity = parsedData.code;

                var inputCnt = contacts.get(0);
                var inputImg = image.get(0);

                let send = confirm(
                    "Anda yakin untuk melakukan pengiriman pesan?",
                );
                if (send) {
                    const readFileUpload = (file, type) => {
                        return new Promise(function (resolve, reject) {
                            let fr = new FileReader();

                            fr.onload = function () {
                                resolve(fr.result);
                            };

                            fr.onerror = function () {
                                reject(fr);
                            };
                            if (type == 0) {
                                fr.readAsText(file);
                            } else if (type == 1) {
                                fr.readAsDataURL(file);
                            }
                        });
                    };

                    if (inputCnt.files.length) {
                        var object = [inputCnt.files[0]];
                        if (inputImg.files.length != 0) {
                            object.push(inputImg.files[0]);
                        }
                        let readers = [];
                        if (!object.length) return;

                        object.forEach((obj, i) => {
                            readers.push(readFileUpload(obj, i));
                        });

                        Promise.all(readers).then((values) => {
                            let object = {};
                            values.forEach((val, i) => {
                                object[`upload${i}`] = val;
                            });
                            object[`schedule`] = schedule;
                            object[`titleMessage`] = titleMessage;
                            object[`identity`] = identity;
                            object[`message`] = message;
                            if (inputImg.files.length != 0) {
                                object[`type`] = inputImg.files[0].type;
                                object[`namefile`] = inputImg.files[0].name;
                            }
                            let data = JSON.stringify(object);
                            $.ajax({
                                type: "POST",
                                url: `${server}/send`,
                                contentType: "application/json",
                                data: data,
                            });
                            $("#contact").val("");
                            $("#schedule").val("");
                            $("#titleMessage").val("");
                            $("#message").val("");
                            $("#image").val("");
                        });
                    }
                }
            });

            socketSetup();
            setInterval(() => {
                checkRestoreMessage();
            }, 2000);
        </script>
    </body>
</html>
